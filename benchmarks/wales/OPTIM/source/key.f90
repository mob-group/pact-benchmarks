MODULE KEY
      IMPLICIT NONE
      SAVE


      INTEGER :: NSUMMARY, NADM, MSTEPS, BFGSSTEPS, NSTEPS, NVALUES, NVECTORS, EFSTEPS, NFREEZE, HINDEX, &
     &        FIXAFTER, NBOXTS, NREPELTS, REPELFROM, BHSTEPS, BHSTEPSMIN, KADJUSTFRQ, GUPTATYPE, &
     &        NDIIA, NINTV, NGRADIENTS, NZERO, NPOWER, NBFGSMAX1, NBFGSMAX2, MNBFGSMAX1, MNBFGSMAX2, PVSTEPS, &
     &        NEVL, NEVS, NHCHECK, NHUP=0, NSTHUP, INTHUP, XMUL, NSTEPMIN, LSYS, MUPDATE, XMUPDATE, &
     &        MMUPDATE, NEBMUPDATE, INTMUPDATE, FILTH, FILTH2, NFAILMAX, NPERMGROUP, GCIMAGE, GCSTEPS, GCUPDATE, GCSEED, &
     &        NUSEEV, PATHSDSTEPS, HMNEVS, HMNEVL, HMNSTEPS, HMNBFGSMAX1, HMNBFGSMAX2, &
     &        BBRM, BBRSTEPS, NORDER, NSECDIAG, STOCKMAXSPIN, BISECTSTEPS, BISECTMAXATTEMPTS, NEBRESEEDINT, NREPULSIVE, &
     &        NNREPULSIVE, NEBRESEEDPOW1, NEBRESEEDPOW2, NCONSTRAINT, NENDHESS, ACKLANDID, RBATOMSMAX, &
     &        DPID, TIPID, PAHID, PAPID, NCARBON, NTSITES, NRBGROUP, INTIMAGE, DUMPINTXYZFREQ, DUMPINTEOSFREQ, &
     &        NRBTRIES, REDOTSIM, REDOBFGSSTEPS, RPIMAGES, RPDOF, SDOXYGEN, SDHYDROGEN, SDCHARGE, BOWMANPES, &
     &        INTCONSEP, PATOM1, PATOM2, INTREPSEP, NCONSTRAINTON, CPREPSEP, CPCONSEP, NCONGEOM, &
     &        NCPREPULSIVE, NCPCONSTRAINT, MAXCONUSE, INTCONSTEPS, INTRELSTEPS, INTSTEPS1, INTLJSTEPS, &
     &        NTRAPPOW, MAXINTIMAGE, CHECKDID, CHECKREPINTERVAL, INTFREEZEMIN, INTNTRIESMAX, INTIMAGEINCR, &
     &        NCONSTRAINTFIX, INTIMAGECHECK, NREPULSIVEFIX, NRANROT, NENDDUP, LOCALPERMNEIGH, &
     &        LOCALPERMMAXSEP, NONEDAPBC, STRUC, QCHEMESNAO, QCHEMESNMO, QCHEMESNZERO, QCHEMESNELEC, PMPATHINR, &
     &        MULTISUNIT, MULTIFUNIT,NIMAGEINST,NGLJ,ST_TSSTEP,LANSTEP,NONFREEZE, &
     &        MCPATHBINS,MCPATHEQUIL,MCPATHSTEPS,MCPATHPRTFRQ,MCPATHTS,MCPATHSCHECK,RPHSLICES,RPHQBINS, &
     &        ITWIST, JTWIST, KTWIST, LTWIST, MCPATHSTART, MCPATHBLOCK, MCPATHOVER, NCPU, MCPATHDOBLOCK, MCMERGES, MCMERGEQ, &
     &        MCMERGEI,GAUSSIANCHARGE,GAUSSIANMULTI,ITG03, REDOTS, QCIPERMCHECKINT, &
     &        MLPIN, MLPSTART, MLPOUT, MLPHIDDEN, MLPDATA, NMLP, N_TO_ALIGN, DJWRBID, STM, NHEXAMERS, &
     &        MLQIN, MLQSTART, MLQOUT, MLQDATA, NMLQ, &
     &        QCIADDREP, QCIBONDS, QCISECOND, MAXNACTIVE, QCIIMAGE, NADDTARGET, NUMNN, MULTI_COUNT, MULTI_LAST, MULTI_STEP, &
     &        NDOF, RECCOUNT, MLPPROBPOS, PUSHOPTMAX, MLPNEIGH, QCICYCN, QCIPDINT, NPEAKS, NDISPLACEMENTS, NROTATIONS, &
     &        MAX_ANGMOM, BNB_NSTEPS, QUIPZ, QCIRESETINT1, QCIRESETINT2, JMAXCON, NCONOFF, QCIINTREPMINSEP, QCIKADJUSTFRQ

      LOGICAL :: DTEST, MASST, RTEST, EFSTEPST, VECTORST, SUMMARYT, DUMPV, DUMPMAG, FREEZE, FREEZERANGE, GRADSQ, &
     &        PGRAD, VALUEST, ADMT, BFGSMINT, BFGSTST, CHECKINDEX, TOSI, CONTAINER, &
     &        GAUSSIAN, CADPAC, PRESSURE, FTEST, DCHECK, CP2K, DFTP, CPMD, CPMDC, FREEZERES, DF1T, &
     &        VARIABLES, FIELDT, OHT, IHT, TDT, D5HT, TWOENDS, PV, FRACTIONAL, BLNT, HYBRIDMINT, &
     &        INDEXT, LANCZOST, NOSHIFT, GAMESSUS, GAMESSUK, PVTS, RIGIDBODY, CASTEP, ONETEP, QCHEM, QCHEMES, VASP, &
     &        BFGSSTEP, EFOLSTEP, BULKT, HUPDATE, NOHESS, READV, NOIT, THOMSONT, SIO2T, SIO2C6T, BISECTT, BISECTDEBUG, &
     &        TOSIC6, TOSIPOL, FIXIMAGE, DFTBT, CHECKCONT, CHECKDT, SHIFTED, READSP, DUMPSP, NOFRQS, &
     &        ALLSTEPS, ALLVECTORS, MWVECTORS, WELCH, BINARY, READHESS, MOVIE, NORESET, TWOD, &
     &        DOUBLET, REOPT, PARALLEL, LINEMIN, FIXD, KEEPINDEX, BSMIN, PRINTPTS, RKMIN, REPELTST,&
     &        REPEL,UNRST, NATBT, ANGLEAXIS, DUMPALLPATHS, GOT, REOPTIMISEENDPOINTS, DUMPDATAT, MORPHT, PERMDIST, &
     &        GREATCIRCLET, DESMDEBUG, GROWSTRINGT, FREEZENODEST, STOCKT, BHINTERPT, BHDEBUG, CHRIGIDT, PERMDISTINIT, &
     &        BBRSDMT, AMBERT, NABT, DUMPSTRUCTURES, ORDERPARAMT, BHINTERPUSELOWEST, STOCKSPIN, LOWESTFRQT, PTSTSTT, &
     &        RBAAT, DBPT, DBPTDT, DMBLPYT, LWOTPT, GBT, GBDT, MSSTOCKT, NIMET, NCAPT, NTIPT, PAHAT, SILANET, &
     &        PAPT, PATCHYDT, PYGT, RADIFT, UNIAXT, STOCKAAT, EFIELDT, BHCHECKENERGYT, &
     &        REDUCEDBONDLENGTHT, CBT, CLOSESTALIGNMENT, NEBRESEEDT, ADDREPT, INTCONSTRAINTT, &
     &        LOCALPERMDIST, DOCROSSCHECK, REDOKADD, REDOPATH1, REDOPATH2, ANGLEAXIS2, ATOMMATCHDIST, ATOMMATCHINIT, &
     &        INSTANTONRATET,RINGPOLYMERT, SDT, BOWMANT, PULLT, RBSYMT, CONPOTT, GRAD4T, RPCYCLICT, RPFIXT, &
     &        CHECKCONINT, ATOMMATCHFULL, NIH2LEPST,NIHEAM7T,NIHLEPST, NIHPAIRONLYT, &
     &        QSPCFWT, QTIP4PFT, CFUSIONT, DUMPINTXYZ, DUMPINTEOS, INTLJT, INTTST, EYTRAPT, OHCELLT, MKTRAPT, &
     &        INTFREEZET, LPERMDIST, CHECKNEGATIVET, CHECKOVERLAPT, ACK1, ACK2, CONDATT, USERPOTT, &
     &        CONCUTFRACT, CONCUTABST, ENDNUMHESS2, CHARMMDFTBT, PAIRCOLOURT, REVERSEUPHILLT, WHOLEDNEB, &
     &        NONEBMAX, READMASST, ONEDAPBCT, ONEDPBCT, INVTONEDPBCT, INVTTWODPBCT, TWODAPBCT, TWODPBCT, THREEDAPBCT, &
     &        THREEDPBCT, FOURDAPBCT, FOURDPBCT, MODEDOWNT, CHEMSHIFT, TTM3T, &
     &        NOINVERSION, INVERTPT, KNOWVECS, PMPATHT, AAORIENTT, MULTIJOBT, QUIPARGSTRT, QUIPPARAMST, HESSDUMPT, &
     &        CLASSICALRATEST, TSPLITTINGT, HESSREADT, INSTANTONOPTT,INSTANTONSTARTDUMPT,VARSTEPOPTT, MOLPRO, REAXFFT, &
     &        EIGENONLY,OVERCONV, GLJT,CLSTRINGT,CLSTRINGTST, PHI4MODT, EX1DT, MCPATHT, MCBIAST, RPHT, TWISTT, MCPATH2T, &
     &        PBST, SSHT, GAUSSIAN03, GAUSSIAN09, CPPNEBT, CUDAT, CUDATIMET, TRUSTMODET,MODELOST, METRICTENSOR, INTSPRINGACTIVET, &
     &        PERMGUESS, QCIPERMCHECK, DUMPFRQST, MULTIPOTT, MLP3T, MLPB3T, DUMPBESTPATH, ALIGNRBST, AVOID_COLLISIONS, MLPPROB, &
     &        MALONALDEHYDE, SIO2PT, MLPNEWREG, DJWRBT, STEALTHYT, STEALTV, LJADDT, MLPB3NEWT, MLPVB3T, &
     &        QCIPOTT, QCIPOT2T, QCIRADSHIFTT, QCINOREPINT, QCIAMBERT, SLERPT, NOTRANSROTT, MAXGAPT, BULKBOXT, GDSQT, FLATTESTT, &
     &        MLQT, MLQPROB, LJADD2T, MACROIONT, NOREGBIAS, PYADDT, PYADD2T, SANDBOXT, LJADD3T, LJADD4T, &
     &        MBPOLT, MULTIJOB_MACHINET, DUMPDATA_MACHINET, PLUSSIDET, MINUSSIDET, PUSHOPTT, MLPVB3NNT, GAUSSIAN16, QCICYCLEST, &
     &        QCIDNEBT, QCIRESTART, QCILPERMDIST, FASTOVERLAPT, BNB_ALIGNT, QUIPT, QCIADDACIDT, DOBACK, QCIRESET, DOBACKALL, &
     &        QCITRILAT, QCISTOP


! sy349 > for testing the flatpath after dneb
      !LOGICAL, ALLOCATABLE :: FLATPATHT(:)
      LOGICAL FLATPATHT

! bf269 > polymer in a pore (non-bonding (LJ) energy from neighbours is not subtracted)
      LOGICAL :: PORE8T = .FALSE. ! add 8th power cylindrical pore to the potential?
      INTEGER :: PORE8_AXIS = 3 ! principal axis of the cylindric pore (1:x, 2:y, 3:z)
      DOUBLE PRECISION :: PORE8_ENERGY = 1.0d1 ! energy of the pore when radius = 1
      LOGICAL :: HARMPOLYT = .FALSE. ! add harmonic bonds between the beads
      DOUBLE PRECISION :: HARMPOLY_BONLEN = 0.0d0 ! equilibrium length of springs between beads
      DOUBLE PRECISION :: HARMPOLY_K = 1.0d2 ! force constant of the springs

! hk286 > generalised THOMSON problem
      LOGICAL :: GTHOMSONT
      DOUBLE PRECISION :: GThomsonZ, GThomsonC, GThomsonC2, VUNDULOID,GTHOMSONBIND
      DOUBLE PRECISION :: GTrefU, GTrefZ, GTmu, GTk, GTm, GTn, GTa, GTc
      INTEGER :: GTHOMMET, NGTHORI, GTHOMPOT, GTHOMSONBINN
      DOUBLE PRECISION :: GThomsonSigma, GThomsonRho

      LOGICAL :: MACHINE=.FALSE., NEBMIND=.TRUE.

      DOUBLE PRECISION :: TRAD, RESIZE, JZ, PUSHOFF, TOLD, TOLE, PCUT, DAMP, RADIUS, TWOEVAL, PVCONV, PVTOL, &
     &        OMEGA, GALPHA, MALPHA1, FOH, FIH, FTD, FD5H, T12FAC, PRESS, MAXERISE, RK_R, RK_THETA, &
     &        CONVU, CONVR, SYMCUT, MXSTP, GFRACTION, CEIG, REPELPUSH, XMAXERISE, GCCONV, NEBK, &
     &        MFRACTION1, MFRACTION2, MALPHA2, ACCLAN, SHIFTLAN, CUTLAN, GMAX, EVCUT, NEBDGUESS, INTDGUESS,  &
     &        MINMAX, MAXMAX, C6PP, C6MM, C6PM, PUSHCUT, MAXBFGS, MAXXBFGS, MAXMBFGS, MAXNEBBFGS, MAXINTBFGS, &
     &        APP, AMM, APM, XQP,XQM, ALPHAP, ALPHAM, PHIG, SHIFTV, DGUESS, XDGUESS, TIMELIMIT, TSTART, &
     &        INTEPSILON, FRAMEEDIFF, MORPHERISE, MORPHEMAX, MORPHMXSTP, MAXTSENERGY, MAXBARRIER, GCMXSTP, GCSCALE, &
     &        FREEZETOL, DESMAXEJUMP, DESMAXAVGE, STOCKMU, STOCKLAMBDA, EDIFFTOL, GEOMDIFFTOL, DNEBSWITCH, &
     &        BHACCREJ, BHSTEPSIZE, BHCONV, BHTEMP, BHDISTTHRESH, BHMAXENERGY, BHK, DIJKSTRALOCAL, KADJUSTFRAC, KADJUSTTOL, &
     &        BHSFRAC, HMCEIG, HMMXSTP, HMEVMAX, BBRGAM, BBREPS, BBRSIGMA1, BBRSIGMA2, BBRALPHA, BBRCONV, STOCKZTOL, &
     &        GBKAPPA, GBKAPPRM, GBMU, GBNU, GBSIGNOT, GBEPSNOT, GBCHI, GBCHIPRM, &
! adk44
     &        CAPSIDRHO, CAPSIDEPS, SIGMAPENT, RADPENT, RADHEX, SIGMAHEX, SIGMAPH, &
     &        PYA1(3), PYA2(3), PYSIGNOT, PYEPSNOT, NEBKINITIAL, NEBKFINAL, NEBFACTOR, &
     &        DBEPSBB, DBEPSAB, DBSIGBB, DBSIGAB, DBPMU, YEPS, YKAPPA, MAXMAXBARRIER, PAPALP, PAPEPS, PAPS, PAPCD, &
     &        RHOCC0, RHOCC10, RHOCC20,  RHOHH0, RHOHH10, RHOHH20, RHOCH0, RHOC10H, RHOCH10, RHOC20H, RHOCH20, &
     &        EPS11, EPS22, EPS12, MRHO, MRHO11, MRHO22, MRHO12, REQ11, REQ22, REQ12, &
     &        ALPHACC, ALPHAHH, ALPHACH, DC6CC, DC6HH, DC6CH, KKJ, CCKJ, KINT, KINTENDS, &
     &        LPDGEOMDIFFTOL, INTCONFRAC, MAXCONE, INTRMSTOL, BFGSTSTOL, ORBITTOL, EVPC, &
     &        BISECTMAXENERGY, BISECTMINDIST, BLFACTOR, NEBRESEEDEMAX, NEBRESEEDBMAX, NEBRESEEDDEL1, &
     &        NEBRESEEDDEL2, INTCONSTRAINTTOL, INTCONSTRAINTDEL, RBCUTOFF, INTCONSTRAINTREP, INTCONSTRAINREPCUT, &
     &        REDOK, REDOFRAC, D1INIT, D2INIT, REDOE1, REDOE2, RPBETA, REPCON, PFORCE, &
     &        CPCONSTRAINTTOL, CPCONSTRAINTDEL, CPCONSTRAINTREP, CPCONSTRAINREPCUT, CPCONFRAC, &
     &        INTLJTOL, INTLJDEL, INTLJEPS, IMSEPMIN, IMSEPMAX, TRAPK, MINOVERLAP, &
     &        INTFREEZETOL, LOCALPERMCUT, LOCALPERMCUT2, LOCALPERMCUTINC, CHECKREPCUTOFF, CONCUTABS, &
     &        CONCUTFRAC, ENDNUMHESSDELTA, DNEBEFRAC, QCHEMSCALE, KAA, SIGMAAA, QUIPATOMMASS, TEMPERATURE1, &
     &        DISTORTINST,DELTAINST,MOLPROSCALE,COVER,STTSRMSCONV,LAN_DIST,LANCONV,LANFACTOR, &
     &        STOCKEXP, JPARAM, MCPATHTEMP, MCPATHDMAX, MCPATHSTEP, MCPATHACCRATIO, BIASFAC, &
     &        MCADDDEV, MCPATHQMIN, MCPATHQMAX, RPHQMIN, RPHQMAX, RPHTEMP, TWISTF, TWISTREF, MCPATHADDREF, &
     &        MCPATHGWS, MCPATHGWQ, MCPATHNEGLECT, MCPATHTOL, FRAMESDIFF,TMRATIO, INTMINFAC, MLPLAMBDA, COLL_TOL, KLIM, SCA, &
     &        NEBMAXERISE, GDSQ, FLATEDIFF, QCIADDREPCUT, QCIADDREPEPS, QCIRADSHIFT, INTCONCUT, MLQLAMBDA, FRQCONV, FRQCONV2, &
     &        TANHFAC, LJADDCUTOFF,LJADDREFNORM,MAXIMFACTOR, PUSHOPTCONV, QCICYCDIST, QCIPERMCUT, KERNELWIDTH, QUIPLATT(3,3), &
     &        ECON, EREP, ESPRING, CONVERGECONTEST, CONVERGEREPTEST, FCONTEST, FREPTEST, QCIKADJUSTTOL, QCIKADJUSTFRAC, QCIAVDEV, &
     &        QCIKINTMAX, QCIKINTMIN

!     sf344
      DOUBLE PRECISION :: PCUTOFF,PYA11(3),PYA21(3),PYA12(3),PYA22(3),PEPSILON1(3),PSCALEFAC1(2),PSCALEFAC2(2), &
     &                     PEPSILONATTR(2),PSIGMAATTR(2), PYOVERLAPTHRESH, LJSITECOORDS(3), LJGSITESIGMA, LJGSITEEPS, &
     &                     PYLOCALSTEP(2),PYCFTHRESH,PYGRAVITYC1,PYGRAVITYC2,PERCCUT
 
      DOUBLE PRECISION, ALLOCATABLE :: PYADDEPS(:,:)
      DOUBLE PRECISION, ALLOCATABLE :: SHIFTL(:)
      LOGICAL, ALLOCATABLE :: uniaxarray(:)
      DOUBLE PRECISION, ALLOCATABLE :: PYADDREP(:,:), PYADDATT(:,:)
      DOUBLE PRECISION, ALLOCATABLE :: POINTSDECA(:), POINTSICOS(:)
      DOUBLE PRECISION, ALLOCATABLE :: VT(:), pya1bin(:,:),pya2bin(:,:),SITE(:,:)
      LOGICAL          :: LJSITE,BLJSITE,LJSITEATTR,PYBINARYT,PARAMONOVPBCX,PARAMONOVPBCY,PARAMONOVPBCZ,PARAMONOVCUTOFF
      LOGICAL          :: PYGPERIODICT,ELLIPSOIDT,LJSITECOORDST,REALIGNXYZ,MULTISITEPYT,LJGSITET,NORMALMODET,PYT,PYCOLDFUSION
      INTEGER          :: MAXINTERACTIONS,PYBINARYTYPE1,MYUNIT,NPYSITE
      DOUBLE PRECISION :: GBANISOTROPYR, GBWELLDEPTHR
!     CHRIS
!     MCP
      LOGICAL :: AMHT
      CHARACTER(LEN=3) :: RES_TYPE_ALA='ALA'
      CHARACTER(LEN=5) :: TARFL
      CHARACTER(LEN=120) :: CASTEPJOB, CP2KJOB, ONETEPJOB, QCHEMJOB, VASPJOB, MULTISTART, MULTIFINISH,MOLPROJOB,REAXFFJOB
      CHARACTER(LEN=30) :: QCHEMJOBPARAMS=''
      CHARACTER(LEN=30) :: MOLPROJOBPARAMS=''
      CHARACTER(LEN=5) :: RPSYSTEM

      INTEGER :: SEQ(500),NUMGLY
      DOUBLE PRECISION :: FINCORD(150,3,3,3)
      INTEGER :: NRES_AMH_TEMP 
     
      INTEGER PROCNT, FINNMRSS, FINNUMCRR, FINNUMPRR, FINNQUENCH

      CHARACTER(LEN=80) :: SYS, FILTHSTR, BOWMANDIR
      CHARACTER(LEN=20) :: EDITIT
      CHARACTER(LEN=4) :: NPROC
      CHARACTER(LEN=2) :: HMMETHOD
      CHARACTER(200) :: CPMD_COMMAND
      LOGICAL :: SCORE_QUEUE
      DOUBLE PRECISION :: EFIELD  ! ELECTRIC FIELD, EFIELD, IN THE Z-DIRECTION
      DOUBLE PRECISION :: COLDFUSIONLIMIT
      LOGICAL, ALLOCATABLE, DIMENSION(:) :: FROZEN, FROZENRES, INTFROZEN  !  MXATMS
      INTEGER, ALLOCATABLE :: NPERMSIZE(:), PERMGROUP(:), ORDERNUM(:)
      INTEGER, ALLOCATABLE :: NSETS(:)
      INTEGER, ALLOCATABLE :: SETS(:,:)
      INTEGER,ALLOCATABLE,DIMENSION(:) :: NGLJSPECIES(:)          ! for GLJ
      DOUBLE PRECISION, ALLOCATABLE :: GLJEPS(:,:), GLJSIG(:,:) ! GLJ parameters
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:) :: CHARGE  !  3*MXATMS
      DOUBLE PRECISION, ALLOCATABLE, DIMENSION(:,:) :: REPELTS  !  3*MXATMS,100
      DOUBLE PRECISION ,ALLOCATABLE :: LJREP_BLN(:,:), LJATT_BLN(:,:), A_BLN(:), B_BLN(:), C_BLN(:), D_BLN(:)
      CHARACTER(LEN=1), ALLOCATABLE :: BEADLETTER(:), BLNSSTRUCT(:)
      CHARACTER(LEN=4), ALLOCATABLE :: WHICHORDER(:)
      INTEGER :: NREPMAX=10, NCPREPMAX=10
      INTEGER :: INTCONMAX=10, NCPCONMAX=10
      DOUBLE PRECISION, ALLOCATABLE :: EPSALPHA(:), DISTREF(:)
      DOUBLE PRECISION, ALLOCATABLE :: CPDISTREF(:)
      DOUBLE PRECISION, ALLOCATABLE :: MIN1REDO(:), MIN2REDO(:)
      DOUBLE PRECISION, ALLOCATABLE :: CONDISTREF(:), CONDISTREFLOCAL(:), CONDISTREFON(:), CONDISTREFLOCALON(:)
      DOUBLE PRECISION, ALLOCATABLE :: CONCUT(:), CONCUTLOCAL(:)
      DOUBLE PRECISION, ALLOCATABLE :: CONDISTREFFIX(:), CONCUTFIX(:)
      DOUBLE PRECISION, ALLOCATABLE :: CPCONDISTREF(:)
      DOUBLE PRECISION, ALLOCATABLE :: INTNEBIMAGES(:)
      DOUBLE PRECISION, ALLOCATABLE :: CONGEOM(:,:)
      DOUBLE PRECISION, ALLOCATABLE :: LJADDEPS(:,:)
      DOUBLE PRECISION, ALLOCATABLE :: LJADDREP(:,:), LJADDATT(:,:)
      LOGICAL, ALLOCATABLE :: CONACTIVE(:)
      LOGICAL, ALLOCATABLE :: ATOMACTIVE(:)
      INTEGER, ALLOCATABLE :: NITSTART(:)
      DOUBLE PRECISION, ALLOCATABLE :: RPMASSES(:), XMINA(:), XMINB(:)
      DOUBLE PRECISION, ALLOCATABLE :: RBOPS(:,:)
      DOUBLE PRECISION, ALLOCATABLE :: SAVES(:), SAVEF(:)
!     LOGICAL, ALLOCATABLE :: CONTEST(:,:)
      INTEGER, ALLOCATABLE :: ORDERI(:), ORDERJ(:), REPPOW(:)
      INTEGER, ALLOCATABLE :: CONI(:), CONJ(:), CONION(:), CONJON(:), CONOFFLIST(:)
      LOGICAL, ALLOCATABLE :: CONOFFTRIED(:)
      INTEGER, ALLOCATABLE :: CONIFIX(:), CONJFIX(:), REPIFIX(:), REPJFIX(:)
      INTEGER, ALLOCATABLE :: REPI(:), REPJ(:)
      INTEGER, ALLOCATABLE :: CPCONI(:), CPCONJ(:)
      INTEGER, ALLOCATABLE :: CPREPI(:), CPREPJ(:)
      DOUBLE PRECISION, ALLOCATABLE :: REPCUT(:), NREPCUT(:), CPREPCUT(:), REPCUTFIX(:)
      INTEGER, ALLOCATABLE :: NREPI(:), NREPJ(:)
      INTEGER, ALLOCATABLE :: BESTPERM(:)
      INTEGER, ALLOCATABLE :: RBGROUP(:), RBNINGROUP(:)
      INTEGER, ALLOCATABLE :: TO_ALIGN(:)
      LOGICAL :: SETCHIRAL=.FALSE.
!BLN/Go parameters
      LOGICAL :: GOTYPE=.FALSE.
      DOUBLE PRECISION :: GOFACTOR=0D0
! Single ended TS search dihedral twisting
      DOUBLE PRECISION :: PSRANDOM
      INTEGER :: NTWISTABLE
      INTEGER, ALLOCATABLE :: DIHETOTWIST(:)
! ONEDAPB
      DOUBLE PRECISION, ALLOCATABLE     :: XYPHI(:)
!
! Macrocycle stuff
!
      LOGICAL :: MACROCYCLET = .FALSE.
      INTEGER :: MCYCLEREPEATS=1 !Number of repeat units in macrocycle
      INTEGER :: MCYCLEPERIOD !Length of repeat units in macrocycle (should be NATOMS/MCYCLEPERIOD)

! periodic boundary conditions
      DOUBLE PRECISION BULK_BOXVEC(3)
      DOUBLE PRECISION POTENTIAL_CUTOFF
      LOGICAL CUTT

!QUIP variables
      CHARACTER(LEN=10240) :: QARGSTR
      CHARACTER(LEN=3) :: QUIPATOMTYPE

! js850> soft sphere potential
      DOUBLE PRECISION, ALLOCATABLE :: SOFT_SPHERE_RADII(:)

!fh301>{{{
      TYPE DIHEDRALPAR
        CHARACTER(LEN=4)  ATYPE
        CHARACTER*8       DIANGLE
        INTEGER           ATYPEID,DIANGLEID
        REAL*8            P1,P2,P3,P4,P5
      END TYPE DIHEDRALPAR
      TYPE RESIDUE
        CHARACTER(LEN=4)  RES
        INTEGER           RESID
        REAL*8            HA,CA,HN,N,CS,CB,NCORR,NCORR2
      END TYPE RESIDUE
      TYPE ONERES
        CHARACTER(LEN=4)  ATYPE
        CHARACTER(LEN=3)  POS
        INTEGER           ATYPEID,POSID
        REAL*8            HA,CA,HN,N,CS,CB
      END TYPE ONERES
      TYPE ONEATOM
        CHARACTER*8       ATYPE
        CHARACTER(LEN=4)  RES
        INTEGER           RESID,ATYPEID
        REAL*8            HA,CA,HN,N,CS,CB
      END TYPE ONEATOM
      TYPE ONEANGLE
        CHARACTER*8       ANGLE
        REAL*8            HA,CA,HN,N,CS,CB
      END TYPE ONEANGLE
      TYPE ONERESPAR
        CHARACTER(LEN=4)  ATYPE
        CHARACTER(LEN=3)  POS
        CHARACTER(LEN=10) PARAM
        REAL*8            HA,CA,HN,N,CS,CB
      END TYPE ONERESPAR
      TYPE TWORES
        CHARACTER(LEN=4)  ATYPE1,ATYPE2
        CHARACTER(LEN=3)  POS1,POS2
        INTEGER           ATID1,ATID2,POSID1,POSID2
        REAL*8            HA,CA,HN,N,CS,CB
      END TYPE TWORES
      TYPE TDERIVATIVE
        TYPE(TDERIVATIVE), POINTER :: NEXT
        TYPE(TDERIVATIVE), POINTER :: PREVIOUS
        REAL*8 :: D(3)
        INTEGER :: ATOM1,ATOM2
      END TYPE TDERIVATIVE
      TYPE TDERIVATIVEDIHEDRAL
        TYPE(TDERIVATIVEDIHEDRAL), POINTER :: NEXT
        TYPE(TDERIVATIVEDIHEDRAL), POINTER :: PREVIOUS
        REAL*8 :: D(3)
        INTEGER :: ATOM
      END TYPE TDERIVATIVEDIHEDRAL
      TYPE TPOINTERS
        TYPE(TDERIVATIVE), POINTER :: LIST=> NULL()
        TYPE(TDERIVATIVE), POINTER :: FIRST=> NULL()
        TYPE(TDERIVATIVE), POINTER :: LAST=> NULL()
      END TYPE TPOINTERS
      REAL*8 :: ENERGYCAMSHIFT, FULLENERGY, CSN, CSALPHA
      REAL*8, DIMENSION(6) :: RMSSHIFT
      REAL*8, DIMENSION(3,7)  :: HYDROPAR
      REAL*8, ALLOCATABLE :: OBSCHEMSHIFT(:,:),ENERGYCAM(:), SHIFTDIF(:)
      REAL*8, ALLOCATABLE :: FORCEX(:), FORCEY(:), FORCEZ(:) 
      LOGICAL COUT
      CHARACTER(LEN=200) :: SVNROOT, CSPATH, SHIFTFILE
      CHARACTER(LEN=10) :: CSVERSION
      TYPE(DIHEDRALPAR) :: DIHED(18)
      TYPE(RESIDUE) :: RANCOIL(20)
      TYPE(ONERES) :: BACKBONEOTH(16),BACKBONEGLY(16),BACKBONEPRO(16)
      TYPE(ONEATOM) :: SIDECHAINOTH(195),SIDECHAINGLY(1),SIDECHAINPRO(9)
      TYPE(ONEATOM) :: HYBSP21(3),HYBSP22(3),HYBSP31(5),HYBSP32(5)
      TYPE(ONEATOM) :: HYBSP21OTH(3),HYBSP22OTH(3),HYBSP31OTH(5)
      TYPE(ONEATOM) :: HYBSP32OTH(5),HYBSP21GLY(3),HYBSP22GLY(3)
      TYPE(ONEATOM) :: HYBSP31GLY(5),HYBSP32GLY(5),HYBSP21PRO(3)
      TYPE(ONEATOM) :: HYBSP22PRO(3),HYBSP31PRO(5),HYBSP32PRO(5)
      TYPE(RESIDUE) :: RINGTYPEOTH(5),RINGTYPEGLY(5),RINGTYPEPRO(5)
      TYPE(ONEANGLE) :: DIHEANGOTH(3),DIHEANGGLY(3),DIHEANGPRO(3)
      TYPE(ONERESPAR) :: HYDROGENOTH(12),HYDROGENGLY(12),HYDROGENPRO(12)
      TYPE(TWORES) :: DISULFID,EXTDISOTH(26),EXTDISGLY(26)
      TYPE(TWORES) :: EXTDISPRO(26)


!     cjf41 collagen order parameter
      LOGICAL :: COLLAGENOP
      INTEGER :: COLLINDICES(4)

!Character string for CUDA potential
      CHARACTER(LEN=1) :: CUDAPOT

      !ds656> Mie field(s) for modelling substrate effects
      LOGICAL :: MIEFT, MIEF_CUTT, MIEF_PBCT
      CHARACTER(LEN=130) :: MIEF_FILENAME
      INTEGER :: MIEF_NSITES,MIEF_N,MIEF_M
      DOUBLE PRECISION :: MIEF_BOX(3), MIEF_RCUT
      DOUBLE PRECISION, ALLOCATABLE :: MIEF_EPS(:), MIEF_SIG(:), &
           MIEF_SITES(:,:), MIEF_U_RCUT(:), MIEF_DUDR_RCUT(:)
      
      DOUBLE PRECISION, ALLOCATABLE ::  QCIXYZ(:)
! AMBER 12 variables
      LOGICAL :: AMBER12T
      LOGICAL :: CHIRALENDPOINTS
      INTEGER, DIMENSION(:,:), ALLOCATABLE :: BONDS
      INTEGER, DIMENSION(:), ALLOCATABLE :: ATOMSTORES

      DOUBLE PRECISION, ALLOCATABLE ::  MLPDAT(:,:)
      INTEGER, ALLOCATABLE ::  MLPOUTCOME(:)
      DOUBLE PRECISION, ALLOCATABLE ::  MLQDAT(:,:)
      INTEGER, ALLOCATABLE ::  MLQOUTCOME(:)
      INTEGER, ALLOCATABLE ::  LJADDNN(:,:)

! OPEP variables
      LOGICAL :: OPEPT, OPEP_RNAT

!Orbital variable
      LOGICAL :: ORBITALS
      INTEGER :: NROTS, NORBS, ORBVAREXPONENT
      DOUBLE PRECISION, ALLOCATABLE :: R2INTS(:,:), DIPINTS(:,:,:)
END MODULE KEY
