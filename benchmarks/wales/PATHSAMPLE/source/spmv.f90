SUBROUTINE SPMV(OUTP, VEC, A, IA, JA, NMIN, NONZERO, NCOL)
   IMPLICIT NONE
   INTEGER NMIN, NCOL(NMIN), J2, J3
   DOUBLE PRECISION SUM, A(NMIN), OUTP(NMIN)
   INTEGER IA(NMIN+1), NONZERO
   INTEGER JA(NONZERO)
   DOUBLE PRECISION VEC(NONZERO)
   CHARACTER(LEN=8) VERSION

   CALL GETENV("SPMV_VERSION", VERSION)
   IF(VERSION == "MKL") THEN
     CALL MKL_SPMV(OUTP, VEC, A, IA, JA, NMIN, NONZERO, NCOL)
   ELSE
     DO J3=1,NMIN
        IF (NCOL(J3).EQ.0) CYCLE
        SUM =0.0D0
        DO J2 = IA(J3), IA(J3+1)-1
           SUM = SUM+VEC(J2)*A(JA(J2)) ! Gauss-Seidel, a bit faster
        ENDDO
        OUTP(J3) = SUM
     ENDDO
   ENDIF
END SUBROUTINE SPMV
