PROGRAM AAXC
IMPLICIT NONE
CHARACTER(LEN=4) DSTRING,ASTRING
CHARACTER(LEN=3) RES
INTEGER NAT, J1, HPOS, OPOS, CPOS, CPOSP

OPEN(UNIT=9,FILE='coords.inpcrd.pdb',STATUS='UNKNOWN')
OPEN(UNIT=7,FILE='constraintfile',STATUS='UNKNOWN')
OPEN(UNIT=8,FILE='aabk',STATUS='UNKNOWN')

DO 

READ(9,'(A4,1X,I6,1X,A4,1X,A3)',END=666) DSTRING,NAT,ASTRING,RES
WRITE(*,'(A4,1X,I6,1X,A4,1X,A3)') DSTRING,NAT,ASTRING,RES
IF (RES.EQ.'PHE') THEN

! HD2 CE1
! HE2 CD1
! HZ  CG
! HE1 CD2
! HD1 CE2
! CB CZ

   WRITE(7,'(2I8)') NAT+17,NAT+10
   WRITE(7,'(2I8)') NAT+15,NAT+8
   WRITE(7,'(2I8)') NAT+13,NAT+7
   WRITE(7,'(2I8)') NAT+11,NAT+16
   WRITE(7,'(2I8)') NAT+9,NAT+14
   WRITE(7,'(2I8)') NAT+4,NAT+12

   DO J1=1,19
      READ(9,'(A4,1X,I6,1X,A4,1X,A3)') DSTRING
   ENDDO

ELSEIF (RES.EQ.'ARG') THEN

! HH12 HH22
! HH12 HH21
! HH11 HH22
! HH11 HH21
! HH11 NE
! HH12 NE
! HH21 NE
! HH22 NE

   WRITE(7,'(2I8)') NAT+18,NAT+21
   WRITE(7,'(2I8)') NAT+18,NAT+20
   WRITE(7,'(2I8)') NAT+17,NAT+21
   WRITE(7,'(2I8)') NAT+17,NAT+20
   WRITE(7,'(2I8)') NAT+17,NAT+13
   WRITE(7,'(2I8)') NAT+18,NAT+13
   WRITE(7,'(2I8)') NAT+20,NAT+13
   WRITE(7,'(2I8)') NAT+21,NAT+13

   DO J1=1,23
      READ(9,'(A4,1X,I6,1X,A4,1X,A3)') DSTRING
   ENDDO

ELSEIF (RES.EQ.'TRP') THEN

! HD1 CD2
! HE1 CG
! HZ2 CE3
! HH2 CD2
! HZ3 CE2
! HE3 CZ2

   WRITE(7,'(2I8)') NAT+9,NAT+21
   WRITE(7,'(2I8)') NAT+11,NAT+7
   WRITE(7,'(2I8)') NAT+14,NAT+19
   WRITE(7,'(2I8)') NAT+16,NAT+21
   WRITE(7,'(2I8)') NAT+18,NAT+12
   WRITE(7,'(2I8)') NAT+20,NAT+13

   DO J1=1,23
      READ(9,'(A4,1X,I6,1X,A4,1X,A3)') DSTRING
   ENDDO

ELSEIF (RES.EQ.'TYR') THEN

! HD1 CE2
! HE1 CD2
! OH CG
! HE2 CD1
! HD2 CE1
! CB CZ

   WRITE(7,'(2I8)') NAT+9,NAT+15
   WRITE(7,'(2I8)') NAT+11,NAT+17
   WRITE(7,'(2I8)') NAT+13,NAT+7
   WRITE(7,'(2I8)') NAT+16,NAT+8
   WRITE(7,'(2I8)') NAT+18,NAT+10
   WRITE(7,'(2I8)') NAT+4,NAT+12

   DO J1=1,20
      READ(9,'(A4,1X,I6,1X,A4,1X,A3)') DSTRING
   ENDDO

ELSEIF (RES.EQ.'HIP') THEN

! HD1 NE2
! HE1 CD2
! HE2 CG
! HD2 ND1

   WRITE(7,'(2I8)') NAT+9,NAT+12
   WRITE(7,'(2I8)') NAT+11,NAT+14
   WRITE(7,'(2I8)') NAT+13,NAT+7
   WRITE(7,'(2I8)') NAT+15,NAT+8

   DO J1=1,17
      READ(9,'(A4,1X,I6,1X,A4,1X,A3)') DSTRING
   ENDDO

ENDIF

ENDDO

666 CONTINUE

REWIND(9)
OPOS=0
HPOS=0
CPOS=0
CPOSP=0

DO

   READ(9,'(A4,1X,I6,1X,A4,1X,A3)',END=667) DSTRING,NAT,ASTRING,RES

   WRITE(*,'(A3)') ASTRING(2:4)

   IF ((ASTRING(2:4).EQ.'N  ').OR. &
  &    (ASTRING(2:4).EQ.'H  ').OR. &
  &    (ASTRING(2:4).EQ.'CA ').OR. &
  &    (ASTRING(2:4).EQ.'HA ').OR. &
  &    (ASTRING(2:4).EQ.'CB ').OR. &
  &    (ASTRING(2:4).EQ.'C  ').OR. &
  &    (ASTRING(2:4).EQ.'O  ').OR. &
  &    (ASTRING(2:4).EQ.'HA2').OR. &
  &    (ASTRING(2:4).EQ.'HA3')) THEN

      WRITE(8,'(I8)') NAT
      IF (ASTRING(2:4).EQ.'O  ') OPOS=NAT
      IF (ASTRING(2:4).EQ.'CA ') THEN
         CPOS=NAT
         IF ((CPOS.GT.OPOS).AND.(OPOS.GT.0)) WRITE(7,'(2I8)') CPOS,OPOS
!
! using this at the moment.
!
         IF (CPOSP.GT.0) WRITE(7,'(2I8)') CPOSP,CPOS  ! Ca with Ca
         CPOSP=CPOS
      ENDIF
      IF (ASTRING(2:4).EQ.'H  ') THEN
         HPOS=NAT
         IF ((HPOS.GT.OPOS).AND.(OPOS.GT.0)) WRITE(7,'(2I8)') OPOS,HPOS
         IF ((HPOS.GT.CPOS).AND.(CPOS.GT.0)) WRITE(7,'(2I8)') CPOS,HPOS
      ENDIF

   ENDIF

ENDDO

667 CONTINUE

CLOSE(7)
CLOSE(8)
CLOSE(9)


END PROGRAM AAXC
